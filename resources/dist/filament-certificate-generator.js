var p="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",o=null;function b({state:v,canvasData:a,options:h}){return{state:v,canvas:null,certData:[],canvasData:a,options:h,init(){this.updateData();let r=new fabric.Canvas(this.$refs.containerRef);this.canvas=r,o=r;var e=this;fabric.Image.fromURL(a.imageURL,function(t){e.canvas.setHeight(a.canvasHeight),e.canvas.setWidth(a.canvasWidth),e.canvas.setBackgroundImage(t,e.canvas.renderAll.bind(e.canvas),{scaleX:e.canvas.width/t.width,scaleY:e.canvas.height/t.height})});let l=document.getElementById("ITextColor"),n=document.createElement("img");n.src=p;function i(t){return function(s,f,u,w,m){var d=this.cornerSize;s.save(),s.translate(f,u),s.rotate(fabric.util.degreesToRadians(m.angle)),s.drawImage(t,-d/2,-d/2,d,d),s.restore()}}l.addEventListener("input",function(){e.canvas.getActiveObject().dirty=!0,e.canvas.getActiveObject().type==="i-text"?e.canvas.getActiveObject().fill=this.value:e.canvas.getActiveObject().type==="image"&&(e.canvas.getActiveObject().filters[0].color=this.value,e.canvas.getActiveObject().applyFilters()),e.state[e.canvas.getActiveObject().id].color=this.value,e.canvas.renderAll()}),fabric.Object.prototype.controls.deleteControl=new fabric.Control({x:.5,y:-.5,offsetY:-16,offsetX:16,cursorStyle:"pointer",mouseUpHandler:g,render:i(n),cornerSize:24});function g(t,c){var s=c.target,f=s.canvas;delete e.state[s.id],f.remove(s),f.requestRenderAll()}if(this.certData.length<=0){let[t,c]=Object.entries(this.options)[0];this.addText(t,c)}else this.certData.forEach(function(t){if(typeof t.value.startY<"u")if(t.value.type==="text"){let c=new fabric.IText(h[t.key],{id:t.key,left:(t.value.startY??a.coefficient)/a.coefficient,top:(t.value.startX??a.coefficient)/a.coefficient,scaleX:t.value?.scaleX??1,scaleY:t.value?.scaleY??1,type:"i-text",objectCaching:!1,editable:!1,fill:t.value?.color??"#000",stroke:"#fff",strokeWidth:.1,fontSize:45});r.add(c),c.on("selected",function(){l.value=c.fill})}else t.value.type==="qr"&&fabric.Image.fromURL("/certificate-generator/qr/n/n/n",function(c){var s=c.set({id:"qr",left:(t.value.startY??a.coefficient)/a.coefficient,top:(t.value.startX??a.coefficient)/a.coefficient,scaleX:t.value?.scaleX??1,scaleY:t.value?.scaleY??1,angle:0,border:"#000",stroke:"#fff",strokeWidth:.1});s.setControlVisible("mtr",!1),s.setControlVisible("mb",!1),s.setControlVisible("mt",!1),s.setControlVisible("ml",!1),s.setControlVisible("mr",!1);let f=fabric.Image.filters;s.filters[0]=new f.BlendColor({color:t.value?.color??"#000000",mode:"add",alpha:1}),s.applyFilters(),r.add(s).renderAll()})});this.canvas.on("object:moving",function(t){e.state[t.target.id].scale=a.coefficient,e.state[t.target.id].startX=a.coefficient*t.target.top,e.state[t.target.id].startY=a.coefficient*t.target.left,e.state[t.target.id].width=a.coefficient*t.target.width*t.target.scaleX,e.state[t.target.id].height=a.coefficient*t.target.height*t.target.scaleY,e.state[t.target.id].scaleY=t.target.scaleY,e.state[t.target.id].scaleX=t.target.scaleX}),this.canvas.on("selection:created",function(t){t.selected[0].type==="i-text"?(document.getElementById("textControls").hidden=!1,l.value=t.selected[0].fill):t.selected[0].type==="image"&&(document.getElementById("textControls").hidden=!1,l.value=t.selected[0].filters[0].color)}),this.canvas.on("before:selection:cleared",function(t){(t.target.type==="i-text"||t.target.type==="image")&&(document.getElementById("textControls").hidden=!0)}),this.canvas.on("object:modified",function(t){e.state[t.target.id].scale=a.coefficient,e.state[t.target.id].startX=a.coefficient*t.target.top,e.state[t.target.id].startY=a.coefficient*t.target.left,e.state[t.target.id].width=a.coefficient*t.target.width*t.target.scaleX,e.state[t.target.id].height=a.coefficient*t.target.height*t.target.scaleY,e.state[t.target.id].scaleY=t.target.scaleY,e.state[t.target.id].scaleX=t.target.scaleX})},updateData:function(){let r=[];for(let[e,l]of Object.entries(this.state??{}))r.push({key:e,value:l});this.certData=r},addText:function(r,e){let l=this.state??{};var n=!1;if(o._objects.forEach(function(i){i.id===r&&(n=!0)}),n===!1){let i=new fabric.IText(e,{id:r,left:o.width/2,top:o.height/2,type:"i-text",objectCaching:!1,editable:!1,fill:"#000",stroke:"#fff",strokeWidth:.1,fontSize:45});o.add(i),l[r]={startY:this.canvasData.coefficient*i.left,startX:this.canvasData.coefficient*i.top,scale:this.canvasData.coefficient,width:this.canvasData.coefficient*i.width*i.scaleX,height:this.canvasData.coefficient*i.height*i.scaleY,type:"text",scaleY:i.scaleY,scaleX:i.scaleX},this.state=l}},addQr:function(){let r=this.state??{};var e=!1;if(o._objects.forEach(function(n){n.id==="qr"&&(e=!0)}),e===!1){var l=this;fabric.Image.fromURL("/certificate-generator/qr/n/n/n",function(n){var i=n.set({id:"qr",left:0,top:0,angle:0,border:"#000",stroke:"#fff",strokeWidth:.1}).scale(.2);i.setControlVisible("mtr",!1),i.setControlVisible("mb",!1),i.setControlVisible("mt",!1),i.setControlVisible("ml",!1),i.setControlVisible("mr",!1);let g=fabric.Image.filters;i.filters[0]=new g.BlendColor({color:"#000000",mode:"add",alpha:1}),i.applyFilters(),o.add(i).renderAll(),r.qr={startY:l.canvasData.coefficient*i.left,startX:l.canvasData.coefficient*i.top,scale:l.canvasData.coefficient,width:l.canvasData.coefficient*i.width*i.scaleX,height:l.canvasData.coefficient*i.height*i.scaleY,type:"qr",scaleY:i.scaleY,scaleX:i.scaleX},l.state=r})}}}}export{b as default};
